# Eldar — TradingAI Technical Intelligence Book  
## Section 5 — CrewAI Layer  
(Многоагентная система TradingAI)

---

## Введение  

CrewAI — это интеллектуальный слой TradingAI, который:

- распределяет задачи  
- анализирует рынок  
- обрабатывает запросы  
- взаимодействует с сервисами  
- формирует выводы  
- работает как «мозг» системы  

CrewAI обеспечивает **многоагентную архитектуру**, которая делает TradingAI масштабируемым, умным и автономным.

---

# 5.1. Архитектура CrewAI

```
             ┌────────────────────────┐
             │   Supervisor Agent      │
             │ (координатор системы)   │
             └──────────────┬─────────┘
                            │
     ┌──────────────────────┼──────────────────────────┐
     │                      │                          │
┌────▼─────┐         ┌──────▼───────┐           ┌──────▼────────┐
│ Market    │         │ News         │           │ Python         │
│ Analyzer  │         │ Screener     │           │ Engineer       │
│ Agent     │         │ Agent        │           │ Agent          │
└───────────┘         └──────────────┘           └───────────────┘
```

Supervisor управляет задачами, а каждый агент выполняет строго свою роль.

---

# 5.2. Supervisor Agent  
(Супервизор)

**Назначение:**  
Распределение задач, контроль агентов, сбор результатов.

Основные функции:

- принимает входящий запрос (Discord или скрипт)  
- определяет, какие агенты необходимы  
- инициирует задачи агентов  
- объединяет результаты  
- формирует финальный отчёт  
- передаёт отчёт обратно в Discord  

Supervisor — главный диспетчер системы.

---

# 5.3. Market Analyzer Agent  
(Аналитик рынка)

**Назначение:**  
Анализирует финансовые инструменты в реальном времени.

Данные, используемые агентом:

- свечи разных таймфреймов  
- snapshot рынка  
- информация о ликвидности  
- волатильность  
- контекст NY Session  
- данные cTrader  

Функции:

- определение тренда  
- поиск уровней  
- поведенческие шаблоны US30 / XAUUSD / SPX  
- формирование торговой картины  
- оценка краткосрочных движений  

Этот агент — ядро рыночного анализа.

---

# 5.4. News Screener Agent  
(Аналитик новостей)

**Назначение:**  
Фильтрует и анализирует информационный поток.

Функции:

- классификация новостей  
- выделение значимых событий  
- связь между новостями и волатильностью  
- влияние на индексы и металл  
- оценка макроэкономической среды  

Используется для ситуаций, где важны контекст и фундаментальные факторы.

---

# 5.5. Python Engineer Agent  
(Технический помощник)

**Назначение:**  
Помогает супервизору и другим агентам выполнять:

- расчёты  
- анализ структур данных  
- формирование таблиц  
- генерацию отчётов  
- работу с файлами  
- преобразования данных  

Используется как вспомогательный инженер внутри CrewAI.

---

# 5.6. cTrader Market Agent  
(Агент для брокерского API)

Этот агент предназначен для:

- получения данных из cTrader  
- анализа символов  
- получения параметров инструментов  
- взаимодействия с Market Engine  

Фактически — AI-слой над брокерским API.

---

# 5.7. Market Engine Agent  
(Агент анализа рыночных условий)

Использует:

- Market Snapshot  
- свечи  
- символы  
- данные Volatility Profile  

Этот агент может:

- искать закономерности  
- оценивать условия сессии  
- формировать «рыночную температуру»  

---

# 5.8. Структура задач (Tasks)

Каждому агенту назначаются задачи.

Пример типов задач:

- market_analysis  
- news_analysis  
- session_analysis  
- generate_report  
- analyze_symbol  
- run_pipeline  

Supervisor определяет:

- приоритет  
- порядок  
- последовательность  
- количество агентов  

Файл:  
```
tasks.yaml (если есть)
```

---

# 5.9. Поток выполнения CrewAI

### 1) Пользователь отправляет команду в Discord  
Пример:  
"Дай анализ рынка US30."

### 2) Discord → Supervisor  
Supervisor создаёт «job» для анализа.

### 3) Supervisor вызывает нужного агента  
Требуется Market Analyzer → он запускается.

### 4) Агент запрашивает данные у сервисов  
cTrader, Market Engine, Session Engine.

### 5) Агент формирует результат  
Анализ → краткий → глубокий.

### 6) Supervisor собирает output  
Формирует финальный отчёт.

### 7) Discord отправляет результат пользователю  

---

# 5.10. Связь CrewAI с Discord

Flow:

```
Discord → Supervisor → Agents → Supervisor → Discord
```

Это позволяет управлять TradingAI через простой интерфейс.

---

# 5.11. Добавление нового агента

Чтобы создать нового агента, нужно:

### Шаг 1 — создать файл  
```
src/trading_ai/agents/my_new_agent.py
```

### Шаг 2 — описать класс агента  
- имя  
- роль  
- поведение  
- метод `run()`

### Шаг 3 — зарегистрировать агента  
в supverisor / crew-файлах.

### Шаг 4 — протестировать через Discord  
командой:
```
/test_agent my_new_agent
```

---

# 5.12. Итоги секции

CrewAI — главный интеллектуальный модуль TradingAI, обеспечивающий:

- логическую структуру  
- разделение ответственности  
- масштабируемость  
- мощный анализ  
- удобное взаимодействие через Discord  

Это делает TradingAI системой уровня hedge-fund internal tools.
