# Eldar — TradingAI Technical Intelligence Book  
## Section 8 — NY Session Engine  
(Аналитический двигатель нью-йоркской торговой сессии)

---

## Введение

NY Session Engine — это внутренний специализированный аналитический модуль TradingAI, предназначенный для:

- оценки поведения рынка во время Нью-Йоркской сессии  
- анализа волатильности  
- поиска характерных паттернов движения  
- построения поведенческой модели инструмента  
- логирования событий сессии  
- подготовки данных для CrewAI  

NY Session Engine — одна из тех функций, которые отличают TradingAI от обычных аналитических ботов.  
Это полноценный «сессионный интеллект».

---

# 8.1. Назначение модуля

NY Session Engine решает следующие задачи:

- отслеживание динамики US30 / XAUUSD / SPX500 при открытии NY  
- понимание рыночного характера в первые 30–90 минут  
- определение направления импульса  
- фиксация ключевых разворотных точек  
- запись логов в структурированный формат  

Этот механизм помогает TradingAI «читать рынок» более глубоко.

---

# 8.2. Роль модуля в архитектуре

NY Session Engine работает в составе:

```
Market Engine → NY Session Engine → CrewAI → Discord → User
```

То есть:

1. Market Engine даёт свечи  
2. NY Session анализирует их  
3. Формируется отчёт  
4. CrewAI может использовать эти данные в своих задачах  
5. Discord отдаёт результат пользователю  

---

# 8.3. Структура модуля в проекте

Путь:

```
src/trading_ai/services/NY Session/
```

Внутри обычно хранятся:

- логика анализа свечей  
- функции по определению волатильности  
- функции по обработке импульсов  
- модели оценки поведения цены  
- логирование промежуточных состояний  

Отчёты часто пишутся в:

```
reports/ny_session_crew_log.jsonl
src/reports/ny_session_crew_log.jsonl
```

---

# 8.4. Типовой workflow NY Session Engine

1. **Получение данных свечей**  
   ```
   candles = get_candles("US30", "M1")
   ```

2. **Определение фазы NY открытия**
   Сессия делится на:
   - pre-market  
   - open  
   - post-open  

3. **Расчёт волатильности**
   - range  
   - avg_movement  
   - impulse strength  
   - ratio of bullish/bearish spread  

4. **Определение модели поведения**
   Модуль анализирует:
   - есть ли направленный импульс  
   - присутствует ли ловушка ликвидности  
   - идёт ли рынком трендовое продолжение  
   - высокая ли неопределённость  

5. **Логирование**
   Модуль сохраняет результаты в jsonl-поток:

   ```
   {
     "timestamp": "...",
     "instrument": "US30",
     "volatility": ...,
     "session_phase": "open",
     "behavior_model": "impulse_continuation"
   }
   ```

6. **Формирование отчёта**
   Модуль создаёт вывод, который может использовать:

   - Supervisor  
   - агенты  
   - Discord  

---

# 8.5. Ключевые аналитические параметры

NY Session Engine ориентируется на:

### 1. Session Momentum  
Какова сила движения после открытия NY?

### 2. Directional Bias  
Среднее направление первых M минут.

### 3. Impulse Absorption  
Поглощение импульсов — важный сигнал.

### 4. Liquidity Probe  
Механизмы снятия стопов на открытии.

### 5. Session Range  
Расширение дневного диапазона.

### 6. Deviations & Reversals  
Резкие развороты после импульса — типично для NY.

---

# 8.6. Пример поведения, фиксируемый системой

### Сценарий:  
US30 перед NY стоял в узком боковике.  
На открытии — резкий импульс вверх, после чего:

- 50% откат  
- выход ниже pre-market  
- разгон вниз  

NY Session Engine фиксирует:

1. **impulse + liquidity sweep + reversal**  
2. высокая вероятность продолжения вниз  
3. повышенную волатильность  
4. расширение дневного диапазона  

---

# 8.7. Использование в связке с CrewAI

CrewAI может:

- спрашивать данные NY Session Engine  
- анализировать поведение  
- учитывать контекст NY в финальных выводах  
- корректировать рекомендации по US30 / XAUUSD  

NY Session Engine выступает как дополнительный аналитический слой.

---

# 8.8. Применение отчётов

Отчёты используются:

- в системном анализе  
- в исследовании поведения инструментов  
- в построении моделей волатильности  
- для улучшения агентов CrewAI  
- для логов и обучения AI  

---

# 8.9. Типы логов, сохраняемых модулем

В `ny_session_crew_log.jsonl` сохраняется:

- время  
- символ  
- волатильность  
- направление импульса  
- модель поведения  
- ключевые уровни  
- статистические параметры  

Это основа для будущего R&D.

---

# 8.10. Итоги секции

NY Session Engine — это:

- специализированный аналитический модуль  
- предназначенный для глубокого анализа поведения рынка  
- работающий в узком временном диапазоне NY open  
- обеспечивающий TradingAI уникальными данными  

Он дополняет Market Engine и делает систему более адаптивной к рыночным реалиям.
