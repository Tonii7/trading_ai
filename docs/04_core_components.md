# Eldar — TradingAI Technical Intelligence Book  
## Section 4 — Core Components  
(Ключевые компоненты системы TradingAI)

---

## Введение  

Этот раздел описывает *основные программные блоки* системы TradingAI.  
Эти компоненты образуют ядро работы архитектуры, обеспечивая:

- сбор данных  
- анализ  
- принятие решений AI-агентами  
- выполнение задач  
- связь между сервисами  
- формирование отчётов  
- мониторинг рынка  

TradingAI — модульная система:  
каждый компонент отвечает только за свою часть логики, что обеспечивает **безопасность, устойчивость и масштабируемость**.

---

# 4.1. Market Engine  
(Движок рыночных данных)

**Назначение:**  
Предоставление актуальных и исторических данных по инструментам для агентов и сервисов.

Market Engine объединяет:

- получение рыночных данных (цены/спреды)  
- свечи  
- объёмы  
- snapshot рынка  
- проверку доступности инструментов  
- кэширование  

**Основные файлы:**

```
src/trading_ai/services/ctrader/ctrader_price_source.py
src/trading_ai/services/ctrader/ctrader_candles_data.py
src/trading_ai/services/ctrader/market_snapshot.py
```

**Функции Market Engine:**

- обращение к cTrader API  
- получение свечей M1/M5/M15/1H и т.д.  
- обработка отсутствующих данных  
- возврат структурированного ответа агентам  
- умная выборка последних данных  

Market Engine напрямую используется агентами CrewAI (Market Analyzer, Session Engine и др.).

---

# 4.2. cTrader Connector  
(Интеграция с брокерским API)

**Назначение:**  
Предоставить доступ к инструментам, свечам, котировкам и параметрам из cTrader Open API.

Основные файлы:

```
ctrader_openapi_client.py
ctrader_symbol_details.py
ctrader_symbols_data.py
ctrader_price_source.py
```

**Ключевые возможности:**

- Authorize → Connect → Fetch Data  
- получение списка символов  
- тикеры, спреды, bid/ask  
- получение свечей в пакетах  
- парсинг данных  
- обработка ошибок API  
- fallback сценарии при 404/timeout  

cTrader Connector является ядром взаимодействия системы с реальным рынком.

---

# 4.3. Discord Bot Engine  
(Центр взаимодействия с пользователем)

**Назначение:**  
Обеспечить командный интерфейс и доставку отчётов.

Путь:

```
src/trading_ai/services/discord/
```

Основные функции:

- приём команд пользователя  
- передача команд в Supervisor Agent  
- отправка результатов  
- логирование взаимодействий  
- тестирование каналов и разрешений (`debug_channels.py`)  
- отправка файлов, текстов, embed-сообщений  

Discord Bot — это "UI" TradingAI, через который управляется почти всё.

---

# 4.4. CrewAI Multi-Agent System  
(Многоагентная интеллектуальная система)

**Назначение:**  
Оркестрировать работу агентов, выполнять анализ, формировать выводы.

Главные файлы:

```
src/trading_ai/run_crew.py
src/trading_ai/agents/**
config: agents.yaml, tasks.yaml
```

**Основные элементы:**

### Supervisor Agent  
- распределяет задачи  
- определяет ответственность агентов  
- собирает результаты  
- объединяет их в единый отчёт  

### Market Analyzer  
- анализирует XAUUSD, US30, SPX500 и др.  
- определяет тренды  
- ищет уровни  
- выдаёт short-term прогнозы  

### News Screener  
- обрабатывает новости  
- фильтрует шум  
- выделяет значимые события  

### Python Engineer  
- выполняет кодовые операции  
- формирует отчёты  
- помогает агентам с вычислениями  

**CrewAI обеспечивает:**

- параллельную работу агентов  
- разделение ответственности  
- прозрачный pipeline  
- расширяемость  

---

# 4.5. Logging Framework  
(Система логирования и отчётности)

Логи и отчёты сохраняются в:

```
reports/
src/reports/
```

Типы данных:

- JSONL (журнал NY Session Crew Logs)  
- TXT отчёты  
- JSON структуры  
- отладочные файлы  

Назначение:

- анализ работы системы  
- проверка корректности данных  
- аудит решений AI  
- разбор работы агентов  

TradingAI сохраняет каждый этап принятия решения — это ключ для прозрачности.

---

# 4.6. Report Generators  
(Модули формирования отчётов)

Система умеет:

- собирать данные из агентов  
- агрегировать результаты  
- форматировать вывод  
- отправлять отчёт в Discord  
- логировать отчёт  

Форматы отчётов:

- structured text  
- jsonl  
- tables  
- markdown-like view  

Эти отчёты используются как пользователем, так и NotebookLM.

---

# 4.7. Output Routing System  
(Система маршрутизации выходных данных)

Конфигурационный файл:

```
src/trading_ai/config/output_routes.yaml
```

Позволяет:

- перенаправлять выводы агентов  
- отправлять данные в Discord или логи  
- включать/выключать компоненты  
- добавлять новые каналы  

Это повысило контроль над поведением системы.

---

# Заключение

Основные компоненты TradingAI — это комплекс взаимодействующих модулей, обеспечивающих:

- сбор данных  
- анализ  
- принятие решений  
- отчётность  
- коммуникацию  

Каждый компонент работает автономно, но строго синхронизирован с другими.  
В совокупности они формируют **мощную, гибкую и безопасную систему**, готовую к масштабированию.
